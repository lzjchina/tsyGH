(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b659f396"],{"3d60":function(e,t,o){},"5c1d":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"phoneLive"},[n("div",{staticClass:"id_test_video_box"},[n("video",{ref:"videoPlayer",attrs:{src:"",id:"id_test_video",autoplay:"",unmuted:"",playsinline:"",controls:""}})]),n("div",{staticClass:"tipsArea"},[n("p",{staticClass:"ptext"},[e._v(e._s(e.liveMsg.liveTitle))]),n("div",{staticClass:"number"},[n("img",{attrs:{src:o("c3e5"),alt:""}}),n("span",[e._v(e._s(e.roomNumber)+"人正在参与")])]),n("div",{staticClass:"voiceItems"},[n("VoicePhone")],1)]),n("div",{staticClass:"describe"},[e._m(0),n("div",{staticClass:"profile",domProps:{innerHTML:e._s(e.liveMsg.profile)}})])])},i=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("h1",{staticClass:"desHead"},[o("dl",[o("dt",[e._v("资料")]),o("dd")]),o("dl",[o("dt",[e._v("聊天")]),o("dd")])])}],r=(o("99af"),o("4de4"),o("2319")),s=o("568b"),c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"VoicePhone"},[o("div",{attrs:{id:"remote_stream"}}),e._l(e.vipUserData,(function(t,n){return o("dl",{key:n,staticClass:"head"},[o("dt",[o("img",{attrs:{src:t.avatar}})]),o("dd",[e._v(e._s(t.userName))])])}))],2)},a=[],l=(o("a4d3"),o("a15b"),o("e439"),o("dbb4"),o("b64b"),o("159b"),o("96cf"),o("1da1")),u=o("ade3"),d=o("5781"),m=o.n(d),p=o("2f62");function f(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?f(Object(o),!0).forEach((function(t){Object(u["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var g={data:function(){return{roomNumber:this.$route.query.room,client:null,sdkAppId:null,userSig:null,localStream:null,getUserId:"",vipUserData:"",getVipWs:null}},computed:h({},Object(p["b"])({auth:function(e){return e.Login.auth},vipUserMsg:function(e){return e.Login.vipUserMsg}})),mounted:function(){var e=this;m.a.checkSystemRequirements().then((function(e){e||(alert("您的浏览器不兼容此应用！\n建议下载最新版Chrome浏览器"),window.location.href="http://www.google.cn/chrome/")})),this.getVipList(),console.log(this.vipUserMsg),"vip"==this.vipUserMsg&&this.initTrtc(),this.setRem(),window.addEventListener("beforeunload",(function(){e.setCurrentFontSize(),e.client.leave().then((function(){console.log("退房成功")})).catch((function(e){console.error("退房失败 "+e)})),e.localStream.stop(),e.localStream.close(),e.getVipWs.close()}))},beforeDestroy:function(){this.getVipWs.close(),this.client.leave().then((function(){})).catch((function(e){console.error("退房失败 "+e)})),this.localStream.stop(),this.localStream.close()},methods:{setRem:function(){var e=window.innerWidth/750;document.getElementsByTagName("html")[0].style["font-size"]=100*e+"px"},setCurrentFontSize:function(){document.getElementsByTagName("html")[0].style["font-size"]="14px"},getVipList:function(){var e=this;this.getVipWs=new WebSocket("".concat(s["a"],"/web/live/").concat(this.roomNumber,"/expert/").concat(this.auth.userId)),this.getVipWs.onmessage=function(t){if("WebSocket连接成功"!==t.data){var o=JSON.parse(t.data);200==o.code&&(e.vipUserData=o.data)}},this.getVipWs.onclose=function(){console.log("关闭")}},getUserSign:function(){var e=this;Object(r["u"])(this.auth.userId).then((function(t){200==t.code&&(e.sdkAppId=t.data.sdkAppId,e.userSig=t.data.userSig,e.getUserId=t.data.userId,e.client=m.a.createClient({mode:"rtc",sdkAppId:e.sdkAppId,userId:e.getUserId,userSig:e.userSig}),e.addStream(),e.joinRoom())}))},initTrtc:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getUserSign();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),joinRoom:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(this.client),e.next=3,this.client.join({roomId:this.roomNumber}).catch((function(e){console.error("进房失败 "+e)})).then(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(o),console.log("进房成功"),e.next=4,t.createLocalStream();case 4:return e.next=6,t.InitLocalStream();case 6:return e.next=8,t.addStream();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),createLocalStream:function(){this.localStream=m.a.createStream({userId:this.getUserId,audio:!0,video:!1})},InitLocalStream:function(){var e=this;this.localStream.initialize().catch((function(e){console.error("初始化本地流失败: "+e)})).then((function(){e.localStream.on("player-state-changed",(function(e){console.log("local stream ".concat(e.type," player is ").concat(e.state))})),e.publishLocalStream()}))},publishLocalStream:function(){this.client.publish(this.localStream).catch((function(e){console.error("本地流发布失败 "+e)})).then((function(){console.log("本地流发布成功")}))},addStream:function(){var e=this;this.client.on("error",(function(e){console.error(e),alert(e)})),this.client.on("client-banned",(function(e){console.error("client has been banned for "+e)})),this.client.on("peer-join",(function(e){var t=e.userId;console.log("peer-join "+t)})),this.client.on("peer-leave",(function(e){var t=e.userId;console.log("peer-leave "+t)})),this.client.on("stream-added",(function(t){var o=t.stream,n=o.getId(),i=o.getUserId();e.client.subscribe(o,{audio:!0,video:!1}).catch((function(e){console.error("failed to subscribe remoteStream"),console.log(e)})),console.log("remote stream added: [".concat(i,"] ID: ").concat(n," type: ").concat(o.getType())),console.log("subscribe to this remote stream")})),this.client.on("stream-subscribed",(function(e){var t=e.userId;console.log(t);var o=e.stream,n=o.getId();o.play("remote_stream"),o.on("player-state-changed",(function(e){console.log("".concat(e.type," player is ").concat(e.state))})),console.log("stream-subscribed ID: ",n)})),this.client.on("stream-removed",(function(e){var t=e.stream,o=t.getId();console.log("stream-removed ID: ".concat(o,"  type: ").concat(t.getType()))})),this.client.on("stream-updated",(function(e){var t=e.stream;console.log("type: "+t.getType()+" stream-updated hasAudio: "+t.hasAudio()+" hasVideo: "+t.hasVideo())})),this.client.on("mute-audio",(function(e){console.log(e.userId+" mute audio")})),this.client.on("unmute-audio",(function(e){console.log(e.userId+" unmute audio")})),this.client.on("mute-video",(function(e){console.log(e.userId+" mute video")})),this.client.on("unmute-video",(function(e){console.log(e.userId+" unmute video")}))}}},v=g,b=(o("f409"),o("2877")),y=Object(b["a"])(v,c,a,!1,null,"38dc2687",null),S=y.exports,w={components:{VoicePhone:S},data:function(){return{playerOptions:{autoplay:!0,muted:!1,loop:!1,preload:"auto",language:"zh-CN",aspectRatio:"16:9",fluid:!0,sources:[{type:"application/x-mpegURL",src:""},{type:"application/x-mpegURL",src:""}],poster:"",notSupportedMessage:"此视频暂无法播放，请稍后再试"},liveMsg:{},roomNumber:0,timer:null,roomNum:this.$route.query.room,rtcUrl:"",baseURL:s["a"]}},mounted:function(){var e=this;this.setRem(),window.addEventListener("beforeunload",(function(){e.setCurrentFontSize()})),this.getRoomNum(),this.wsLink()},beforeDestroy:function(){this.setCurrentFontSize()},methods:{setRem:function(){var e=window.innerWidth/750;document.getElementsByTagName("html")[0].style["font-size"]=100*e+"px"},setCurrentFontSize:function(){document.getElementsByTagName("html")[0].style["font-size"]="14px"},wsLink:function(){var e=this,t=this.$route.query.room;this.WS=new WebSocket("".concat(this.baseURL,"/web/live/").concat(t,"/audience-count")),this.WS.onopen=function(){console.log("连接")},this.WS.onmessage=function(t){var o=JSON.parse(t.data);e.roomNumber=o.data},this.WS.onclose=function(){console.log("关闭")}},getRoomNum:function(){var e=this.$route.query.room;this.getLiveDetails(e)},getLiveDetails:function(e){var t=this;Object(r["b"])(e).then((function(e){if(200==e.code){t.liveMsg=e.data;var o=e.data.playList,n=o.filter((function(e){return 3==e.type})),i=o.filter((function(e){return 1==e.type})),r=o.filter((function(e){return 4==e.type}));t.playerOptions.sources[0].src=n[0].playUrl,t.playerOptions.sources[1].src=i[0].playUrl,t.rtcUrl=r[0].playUrl,t.loadScript((function(){return t.initVideo("id_test_video")}),{id:"tcPlayerScriptId",url:"https://jssdk-70126.njc.vod.tencent-cloud.com/WebRTCAPI.min.js"})}}))},loadScript:function(e,t){if(document.getElementById(t.id))e();else{var o=document.createElement("script");o.async=!0,o.src=t.url,o.id=t.id,o.onload=function(){e()},document.body.appendChild(o)}},initVideo:function(){var e=this.$refs.videoPlayer;TXWebRTCAPI.pullStream(this.rtcUrl,e.id),TXWebRTCAPI.on("onAddStream",this.onAddStream),TXWebRTCAPI.on("onRemoveStream",this.onRemoveStream),TXWebRTCAPI.on("onEvent",this.onEvent)},onAddStream:function(e){console.log(e);var t=document.getElementById("id_test_video");t.srcObject=e.stream,t.autoplay=!0,t.playsinline=!0;var o=t.play();o&&o.then((function(){console.log("play ok!")})).catch((function(){console.log("play failed!")}))},onRemoveStream:function(e){console.log("停了"),console.log("[client_demo]onRemoveStream, ".concat(JSON.stringify(e),", code: ").concat(e.code)),console.log("停了")},onEvent:function(e){console.log("[client_demo]onEvent, e:",e);var t=e.type,o=e.content;if("client_detect"==t){console.log("是否支持webrtc"),console.log(o.errcode),console.log("是否支持webrtc");o.errcode}else if("session_id"==t){var n=o.sessionid;console.log("----------session_id-------------"),console.log("[client_demo]onEvent, notify session_id: ".concat(n)),console.log("----------session_id-------------")}else if("stream_state"==t){var i=o.code,r=o.streamurl;console.log("----------codecode-------------"),console.log(i),console.log("----------codecode-------------"),10014==i&&console.log("[client_demo]onEvent, notify streamUrl: "+r+" invalid")}}}},I=w,_=(o("7c77"),Object(b["a"])(I,n,i,!1,null,null,null));t["default"]=_.exports},"7c77":function(e,t,o){"use strict";var n=o("3d60"),i=o.n(n);i.a},c441:function(e,t,o){},f409:function(e,t,o){"use strict";var n=o("c441"),i=o.n(n);i.a}}]);